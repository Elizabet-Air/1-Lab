#include <stdio.h>
#include <stdlib.h>

#include <string.h>
#include <fcntl.h>

int main(int argc, char const *argv[])
{
	char name[] = "1.txt";
	int strLength = 0, num, i = 0, position = 0; // длина строки, номер и позиция

	int file1;

	file1 = open(name, O_RDONLY); // открытие файла только для чтения
	
	int *lengths = NULL;
	int *positions = NULL;


	char buff[64];

	lengths = (int*)malloc(1 * sizeof(int)); //объявление динамического массива
    
    while(read(file1, buff, 1) != 0){ 
    	if (buff[0] == '\n')
    	{
    		lengths[i] = strLength;
    		i++;
    		position = lseek(file1, 0, SEEK_CUR); // Функция lseek() устанавливает указатель положения в 							 файле. 0 - Смещение отсчитывается от начала файла
    		positions = (int*)realloc(positions, (i+1) * sizeof(int)); // создание динамичекого массива
    		lengths = (int*)realloc(lengths, (i+1) * sizeof(int));
    		positions[i] = position;

    		strLength = 0;
    	}else{
 		   	strLength++;
    	}

    }

    lengths[i] = strLength;
    positions = (int*)realloc(positions, (i + 2) * sizeof(int));  // создание динамичекого массива
    positions[i+1] = lseek(file1, 0, SEEK_END);

	do{
		memset(buff, 0, 64);  // Функция memset заполняет первые 64 байт области памяти, на которую 					указывает аргумент buff, символом, код которого в данной программе 0.
		printf("\nВведите номер строки\n");
		scanf("%d", &num);
		if(num > i+1){
			printf("В файле всего %d строк(и), введите номер строки из этого диапазона\n", i+1);
		}else if(num != 0){
			lseek(file1, positions[num-1], SEEK_SET);
			strLength = lengths[num-1];
			read(file1, buff, strLength); // чтение strLength байт из файла
			printf("\n%s, длина %d\n", buff, strLength);
		}

	} while(num != 0);


/*	for (int n = 0; n < i; n++){
	    printf("\n%d, %d\n", positions[n], lengths[n]);
	}	*/

	

	close(file1); // закрытие файла
	free(positions);  // Функция free освобождает место в памяти. Блок памяти,
	free(lengths);




	return 0;
}
